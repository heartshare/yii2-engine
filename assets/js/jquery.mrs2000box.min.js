jQuery.fn.mrs2000box=function(D){var c=jQuery.extend({advanced:!1,err_img_path:"/img/err-img.gif"},D),g=this,j=!1;g.click(function(){function s(){return a==k.length-1?0:a+1}function x(){c.advanced&&(n=!1,p=!0,t=!1,q.attr("src",k[s()].attr("href")).unbind("error").bind("error",function(){k[s()].attr("href",c.err_img_path);m()}));var f=b.width(),a=b.height(),g=e.width()-40,j=e.height()-40;if(f>g){f=g;for(b.width(f);b.height()>j;)b.width(f),f--;a=b.height()}if(a>j){a=j;for(b.height(a);b.width()>g;)b.height(a),
a--;f=b.width()}h.addClass("darkbox-canvas-load").animate({width:f,marginLeft:-f/2,height:a,marginTop:-a/2},500,function(){h.addClass("darkbox-canvas-done");r.addClass("darkbox-button-on");r.addClass("darkbox-button-right");if(c.advanced){var e=a/2-32+"px";u.addClass("darkbox-button-on").css("top",e);v.addClass("darkbox-button-on").css("top",e)}b.animate({opacity:1},500,function(){if(c.advanced){var a=d.attr("rel");d.attr("href")!=c.err_img_path&&(void 0!=a&&""!=a&&"0"!=a)&&l.addClass("darkbox-button-on").css("width",
f-6+"px").html("<b>\u0424\u043e\u0442\u043e \u2116"+d.attr("rel")+"</b>"+d.attr("title")).animate({opacity:0.5},1)}})})}function y(){b=jQuery('<img src="'+d.attr("href")+'" />');b.appendTo(h).load(x).error(function(){d.attr("href",c.err_img_path);m()})}function m(){t=!0;n&&y()}function z(){p=!1;h.removeClass("darkbox-canvas-done");h.removeClass("darkbox-canvas-load");r.removeClass("darkbox-button-on");!0==c.advanced&&(u.removeClass("darkbox-button-on"),v.removeClass("darkbox-button-on"),l.removeClass("darkbox-button-on"));
b.remove()}if(j)return!1;j=!0;0==jQuery("div.mrs2000box-frame").length&&(box=jQuery('<div class="mrs2000box-frame"><div class="darkbox-shadow"></div><div class="darkbox-canvas"><div class="darkbox-button" title="\u0417\u0430\u043a\u0440\u044b\u0442\u044c (Esc)"></div><div class="darkbox-button-next" title="\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f (\u0421\u0442\u0440\u0435\u043b\u043a\u0430 \u0432\u043f\u0440\u0430\u0432\u043e)"></div><div class="darkbox-button-prev" title="\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0430\u044f (\u0421\u0442\u0440\u0435\u043b\u043a\u0430 \u0432\u043b\u0435\u0432\u043e)"></div><div class="darkbox-description" title="\u0421\u043a\u0440\u044b\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"></div></div></div>').appendTo("body"));
var e=box.clone().appendTo("body").addClass("darkbox-frame-on"),A=e.find("div.darkbox-shadow").animate({opacity:0.6},300),h=e.find("div.darkbox-canvas"),r=e.find("div.darkbox-button"),u=e.find("div.darkbox-button-next"),v=e.find("div.darkbox-button-prev"),l=e.find("div.darkbox-description"),b,p=!1;if(c.advanced)var q,n=!0,t=!1,a,d,k=[];var w=function(){h.remove();A.animate({opacity:0},300,function(){e.remove()});j=!1};if(!0==c.advanced)var B=function(){z();a=s();d=k[a];t?y():n=!0;return!1},C=function(){z();
a=0==a?k.length-1:a-1;d=k[a];n=!0;q.attr("src",d.attr("href"));return!1};jQuery(document).keyup(function(a){switch(a.which){case 27:w();break;case 39:p&&B();break;case 37:p&&C()}});A.click(w);r.click(w);c.advanced&&(u.click(B),v.click(C),l.mouseover(function(){l.animate({opacity:0.9},150)}).mouseout(function(){l.animate({opacity:0.5},150)}).click(function(){l.removeClass("darkbox-button-on")}));c.advanced?(d=jQuery(this),a=g.index(d),g.each(function(){k.push(jQuery(this))}),q=jQuery('<img src="'+
d.attr("href")+'" style="display: none" />'),q.appendTo(h).load(m).error(function(){d.attr("href",c.err_img_path);m()})):(b=jQuery('<img src="'+jQuery(this).attr("href")+'"/>'),b.appendTo(h).load(x).error(function(){b.attr("src",c.err_img_path);m()}));return!1});return g};